build_type: fpm
package_name: pam_docker

fpm_script:
- when: before_install
  do: echo "COMMON BEFORE PACKAGE INSTALL"
- when: after_install
  do: echo "COMMON AFTER PACKAGE INSTALL"

os:
  ubuntu:
    prepare:
    - apt-get install -y libpam0g-dev
    fpm_config_files:
      build/etc/security/docker.conf: /etc/security/docker.conf
    fpm_files:
      build/usr/share/pam-configs/docker: /usr/share/pam-configs/docker
      build/lib/security/pam_docker.so: /lib/security/pam_docker.so
    fpm_script:
    - when: before_remove
      do: echo "UBUNTU BEFORE REMOVE"
    - when: [after_install, after_upgrade, after_remove]
      do:
      - echo "updating pam auth ..."
      - pam-auth-update --package
      - echo "updating pam auth DONE"
  centos:
    fpm_config_files:
      build/etc/security/docker.conf: /etc/security/docker.conf
      build/usr/share/pam-configs/docker: /etc/pam.d/docker
    fpm_files:
      build/lib/security/pam_docker.so: /lib64/security/pam_docker.so
    prepare:
    - yum install -y pam-devel
    fpm_script:
    - on: after_remove
      do: echo 'CENTOS AFTER REMOVE'

before_build:
- make clean
- make
- DESTDIR=./build make install

target:
- ubuntu
- ubuntu-12.04
- centos
