build_type: fpm

package_name: pam_docker
package_version: 0.1.0-1

before_build:
- make
- DESTDIR=build make install

ubuntu:
  prepare:
  - apt-get install -y libpam0g-dev
  fpm_files:
    /usr/share/pam-configs/docker: config/pam_auth_update.conf
    /lib/security/pam_docker.so: build/pam_docker.so
  fpm_script:
  - when: [after_install, after_upgrade, after_remove]
    do: echo "updating pam auth ..." && pam-auth-update --package && echo "updating pam auth OK"

centos:
  prepare:
  - yum install -y pam-devel
  fpm_files:
    /lib64/security/pam_docker.so: build/pam_docker.so

target:
- ubuntu/14.04
- ubuntu/12.04
- centos/centos7
